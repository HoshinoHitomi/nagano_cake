<div class="container mt-4">

  <h3>注文履歴詳細</h3>

  <div class="row mt-4">

    <div class="col-2">

      <p>購入者</p>

      <p>注文日</p>

      <p>配送先<br>　</p>

      <p>支払方法</p>

      <p>注文ステータス</p>

    </div>

    <div class="col-5">
      <p><%= link_to @order.customer.name, admin_customer_path(@order.customer.id) %></p>
      <p><%= @order.created_at.strftime('%Y/%m/%d')%></p>
      <p><%= @order.postal_code %><%= @order.address %><br><%= @order.name %></p>
      <p><%= @order.payment_i18n %></p>

      <%= form_with(model: @order, url: admin_order_update_path(@order), method: :patch, local: true, class: "form-row") do |f| %>
        <%= f.select :status, Order.statuses_i18n.invert, {prompt: false}, class:"form-control form-control-sm col-6"  %>
        <%= f.submit "更新", class: 'btn btn-success' %>
      <% end %>

      <p><%= @order.status_i18n %></p>

    </div>

  </div>

  <div class="row">

    <table class="table col-7">
      <tr>
        <th>商品名</th>
        <th>単価(税込)</th>
        <th>数量</th>
        <th>小計</th>
        <th>製作ステータス</th>
      </tr>
    <% @order_items.each do |order_item| %>
      <tr>
        <td><%= order_item.item.name %></td>
        <td><%= order_item.item.add_tax_price.to_s(:delimited) %></td>
        <td><%= order_item.amount %></td>
        <td><%= (order_item.amount * order_item.item.add_tax_price).to_s(:delimited) %></td>
        <td><%= order_item.making_status_i18n %></td>
      </tr>
    <% end %>
    </table>

    <div class="col-5">
      <!--合計を出す-->
      <h4>商品合計</h4>
      <%= @order_items.sum(:price).to_s(:delimited) %>

      <h4>送料</h4>
      <%= @order.shipping_cost %>

      <h4>請求金額合計</h4>
      <%= @order.total_payment.to_s(:delimited) %>

    </div>
  </div>

</div>